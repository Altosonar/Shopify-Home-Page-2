<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Home Page Builder</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@400;500;600;700&family=Roboto:wght@300;400;500;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #7209b7;
            --accent: #f72585;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --light-gray: #e9ecef;
            --success: #4cc9f0;
            --warning: #f8961e;
            --danger: #f94144;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.15);
            --radius: 8px;
            --radius-lg: 12px;
        }

        body {
            font-family: 'Roboto', sans-serif;
            color: var(--dark);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 95vh;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        /* Header */
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            background: var(--dark);
            color: white;
            border-bottom: 3px solid var(--primary);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.8rem;
            font-weight: 700;
            font-family: 'Montserrat', sans-serif;
        }

        .logo i {
            color: var(--accent);
        }

        .header-actions {
            display: flex;
            gap: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: var(--radius);
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-secondary:hover {
            background: #5a08a1;
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #3ab8d8;
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn-outline {
            background: transparent;
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .btn-outline:hover {
            border-color: white;
            transform: translateY(-2px);
        }

        /* Main Content */
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 320px;
            background: var(--light);
            border-right: 1px solid var(--light-gray);
            overflow-y: auto;
            padding: 20px 0;
        }

        .sidebar-section {
            padding: 20px;
            border-bottom: 1px solid var(--light-gray);
        }

        .sidebar-section:last-child {
            border-bottom: none;
        }

        .sidebar-section h3 {
            margin-bottom: 15px;
            color: var(--dark);
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Poppins', sans-serif;
        }

        .sidebar-section h3 i {
            color: var(--primary);
        }

        /* Templates Grid */
        .templates-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .template-item {
            background: white;
            border-radius: var(--radius);
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            box-shadow: var(--shadow);
        }

        .template-item:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .template-item.active {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .template-preview {
            height: 100px;
            background-size: cover;
            background-position: top;
            position: relative;
        }

        .template-preview:after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, transparent 0%, rgba(0,0,0,0.1) 100%);
        }

        .template-info {
            padding: 12px;
        }

        .template-info h4 {
            font-family: 'Poppins', sans-serif;
            margin-bottom: 5px;
            font-size: 0.95rem;
        }

        .template-info p {
            font-size: 0.8rem;
            color: var(--gray);
        }

        /* Elements Grid */
        .elements-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .element-item {
            background: white;
            border-radius: 8px;
            padding: 12px 8px;
            text-align: center;
            cursor: grab;
            border: 2px solid transparent;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
        }

        .element-item:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }

        .element-item i {
            font-size: 22px;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .element-item span {
            display: block;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--dark);
            font-family: 'Poppins', sans-serif;
        }

        /* Builder Area */
        .builder-area {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
            background: #f5f7fb;
            position: relative;
        }

        .drop-zone {
            min-height: 800px;
            background: white;
            border-radius: var(--radius-lg);
            border: 3px dashed #cbd5e1;
            padding: 25px;
            transition: all 0.3s ease;
            position: relative;
        }

        .drop-zone.active {
            border-color: var(--primary);
            background: rgba(67, 97, 238, 0.05);
        }

        .drop-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 700px;
            color: var(--gray);
            text-align: center;
            padding: 20px;
        }

        .drop-placeholder i {
            font-size: 64px;
            margin-bottom: 20px;
            color: #cbd5e1;
        }

        .drop-placeholder h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            font-family: 'Poppins', sans-serif;
        }

        .drop-placeholder p {
            max-width: 400px;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        /* Page Elements */
        .page-element {
            position: relative;
            border: 2px solid transparent;
            border-radius: var(--radius-lg);
            margin-bottom: 25px;
            transition: all 0.3s ease;
            background: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        .page-element:hover {
            border-color: var(--accent);
        }

        .page-element.selected {
            border-color: var(--primary);
            box-shadow: 0 6px 12px rgba(67, 97, 238, 0.15);
        }

        .element-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--dark);
            border-radius: 20px;
            padding: 5px 10px;
            display: flex;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 10;
        }

        .page-element:hover .element-controls {
            opacity: 1;
        }

        .element-controls button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 14px;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s ease;
        }

        .element-controls button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* ===== NEW ELEMENT STYLES ===== */
        
        /* Image & Text Section */
        .image-text-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 50px;
            padding: 60px 40px;
            align-items: center;
        }

        .image-text-section.image-left .section-image {
            order: 1;
        }

        .image-text-section.image-left .section-content {
            order: 2;
        }

        .image-text-section.image-right .section-image {
            order: 2;
        }

        .image-text-section.image-right .section-content {
            order: 1;
        }

        .section-image {
            height: 400px;
            background: var(--light-gray);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }

        .section-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--gray);
            text-align: center;
            padding: 20px;
        }

        .image-placeholder i {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .section-content {
            padding: 20px;
        }

        .section-content h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: var(--dark);
        }

        .section-content p {
            font-size: 1.1rem;
            line-height: 1.7;
            color: var(--gray);
            margin-bottom: 25px;
        }

        /* Collection Section */
        .collection-section {
            padding: 60px 40px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }

        .collection-section h2 {
            text-align: center;
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .collection-section .subtitle {
            text-align: center;
            color: var(--gray);
            font-size: 1.1rem;
            margin-bottom: 40px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .collection-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
            margin-top: 30px;
        }

        .collection-item {
            background: white;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .collection-item:hover {
            transform: translateY(-10px);
            box-shadow: var(--shadow-lg);
        }

        .collection-image {
            height: 250px;
            background: var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .collection-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .collection-info {
            padding: 25px;
        }

        .collection-info h3 {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .collection-info p {
            color: var(--gray);
            margin-bottom: 15px;
            font-size: 0.95rem;
        }

        /* Custom Liquid/Embed Section */
        .custom-liquid-section {
            padding: 60px 40px;
            background: var(--dark);
            color: white;
            border-radius: var(--radius-lg);
        }

        .custom-liquid-section h2 {
            text-align: center;
            font-family: 'Montserrat', sans-serif;
            font-size: 2rem;
            margin-bottom: 20px;
            color: white;
        }

        .code-editor {
            background: #1a1a1a;
            border-radius: var(--radius);
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #f8f8f8;
            min-height: 200px;
            border: 1px solid #333;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .code-editor:empty:before {
            content: "Paste your custom HTML, CSS, JavaScript or embed code here...";
            color: #666;
        }

        .code-preview {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            margin-top: 20px;
            min-height: 200px;
            border: 2px dashed var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray);
        }

        /* Existing Element Styles (Enhanced) */
        .hero-section {
            padding: 100px 40px;
            text-align: center;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            position: relative;
            overflow: hidden;
        }

        .hero-section h1 {
            font-size: 3.5rem;
            margin-bottom: 20px;
            font-family: 'Playfair Display', serif;
        }

        .hero-section p {
            font-size: 1.3rem;
            max-width: 700px;
            margin: 0 auto 30px;
            line-height: 1.6;
            opacity: 0.9;
        }

        .features-section {
            padding: 80px 40px;
            background: white;
        }

        .features-section h2 {
            text-align: center;
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--dark);
        }

        .features-section .subtitle {
            text-align: center;
            color: var(--gray);
            font-size: 1.1rem;
            margin-bottom: 50px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
        }

        .feature-card {
            text-align: center;
            padding: 40px 30px;
            border-radius: var(--radius);
            background: var(--light);
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: var(--shadow-lg);
        }

        .feature-card i {
            font-size: 48px;
            color: var(--primary);
            margin-bottom: 25px;
        }

        .feature-card h3 {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: var(--dark);
        }

        /* Testimonials Section */
        .testimonials-section {
            padding: 80px 40px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }

        .testimonials-section h2 {
            text-align: center;
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            margin-bottom: 50px;
            color: var(--dark);
        }

        .testimonials-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 30px;
            max-width: 1000px;
            margin: 0 auto;
        }

        .testimonial-card {
            background: white;
            padding: 40px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            position: relative;
        }

        .testimonial-card:before {
            content: '"';
            font-size: 80px;
            color: var(--primary);
            opacity: 0.2;
            position: absolute;
            top: 20px;
            left: 30px;
            font-family: serif;
        }

        .testimonial-text {
            font-size: 1.1rem;
            line-height: 1.7;
            color: var(--dark);
            margin-bottom: 25px;
            position: relative;
            z-index: 1;
        }

        .testimonial-author {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .author-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.5rem;
        }

        /* Newsletter Section */
        .newsletter-section {
            padding: 80px 40px;
            background: linear-gradient(135deg, var(--accent) 0%, #b5179e 100%);
            color: white;
            text-align: center;
        }

        .newsletter-section h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            margin-bottom: 20px;
        }

        .newsletter-section p {
            font-size: 1.2rem;
            margin-bottom: 40px;
            opacity: 0.9;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .newsletter-form {
            max-width: 500px;
            margin: 0 auto;
            display: flex;
            gap: 10px;
        }

        .newsletter-form input {
            flex: 1;
            padding: 15px 20px;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-family: 'Roboto', sans-serif;
        }

        /* Footer Section */
        .footer-section {
            padding: 60px 40px;
            background: var(--dark);
            color: white;
        }

        .footer-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 40px;
        }

        .footer-column h3 {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.2rem;
            margin-bottom: 25px;
            color: white;
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 12px;
        }

        .footer-links a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer-links a:hover {
            color: white;
            padding-left: 5px;
        }

        .footer-bottom {
            text-align: center;
            margin-top: 50px;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
        }

        /* Editable Content */
        [contenteditable="true"] {
            outline: none;
            padding: 2px 4px;
            border-radius: 3px;
            transition: background 0.2s ease;
            min-height: 20px;
        }

        [contenteditable="true"]:hover {
            background: rgba(67, 97, 238, 0.05);
        }

        [contenteditable="true"]:focus {
            background: rgba(67, 97, 238, 0.1);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 30px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--light-gray);
        }

        .modal-header h2 {
            color: var(--dark);
            font-size: 1.8rem;
            font-family: 'Montserrat', sans-serif;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--gray);
            transition: color 0.3s ease;
        }

        .close-modal:hover {
            color: var(--danger);
        }

        /* Export Options */
        .export-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 25px;
        }

        .export-option {
            border: 2px solid var(--light-gray);
            border-radius: var(--radius);
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .export-option:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
        }

        .export-option i {
            font-size: 40px;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .export-option h3 {
            margin-bottom: 10px;
            color: var(--dark);
            font-family: 'Montserrat', sans-serif;
        }

        .export-option p {
            color: var(--gray);
            font-size: 0.9rem;
        }

        /* Code Output */
        .code-output {
            background: var(--dark);
            color: var(--light);
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
            display: none;
            position: relative;
        }

        .code-output.active {
            display: block;
        }

        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            color: var(--light);
        }

        .copy-code-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: var(--radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        .copy-code-btn:hover {
            background: var(--primary-dark);
        }

        /* Media Upload Area */
        .media-upload-area {
            border: 2px dashed var(--light-gray);
            border-radius: var(--radius);
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .media-upload-area:hover {
            border-color: var(--primary);
            background: rgba(67, 97, 238, 0.03);
        }

        .media-upload-area i {
            font-size: 36px;
            color: var(--gray);
            margin-bottom: 10px;
        }

        .uploaded-media {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: white;
            border-radius: var(--radius);
        }

        .uploaded-media-item {
            height: 80px;
            background-size: cover;
            background-position: center;
            border-radius: var(--radius);
            position: relative;
            cursor: pointer;
        }

        .uploaded-media-item:hover .media-overlay {
            opacity: 1;
        }

        .media-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        /* Icon Grid */
        .icon-categories {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .icon-category-btn {
            padding: 6px 12px;
            background: white;
            border: 1px solid var(--light-gray);
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .icon-category-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .icon-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: white;
            border-radius: var(--radius);
        }

        .icon-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px 5px;
            background: var(--light);
            border-radius: var(--radius);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .icon-item:hover {
            background: var(--primary);
            color: white;
            transform: scale(1.05);
        }

        /* Notification */
        .notification {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--success);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 12px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
            z-index: 1001;
            max-width: 400px;
        }

        .notification.active {
            opacity: 1;
            transform: translateY(0);
        }

        .notification.error {
            background: var(--danger);
        }

        .notification.warning {
            background: var(--warning);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                overflow-y: visible;
                display: grid;
                grid-template-columns: repeat(2, 1fr);
            }
            
            .image-text-section,
            .collection-grid,
            .features-grid,
            .footer-grid,
            .testimonials-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                grid-template-columns: 1fr;
            }
            
            .image-text-section,
            .collection-grid,
            .features-grid,
            .footer-grid,
            .testimonials-grid {
                grid-template-columns: 1fr;
            }
            
            .image-text-section {
                grid-template-columns: 1fr;
                gap: 30px;
            }
            
            .newsletter-form {
                flex-direction: column;
            }
            
            .hero-section h1 {
                font-size: 2.5rem;
            }
            
            .section-content h2,
            .collection-section h2,
            .features-section h2,
            .testimonials-section h2 {
                font-size: 2rem;
            }
        }

        @media (max-width: 576px) {
            .app-header {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }
            
            .header-actions {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .builder-area {
                padding: 15px;
            }
            
            .drop-zone {
                padding: 15px;
            }
            
            .hero-section,
            .image-text-section,
            .collection-section,
            .features-section,
            .testimonials-section,
            .custom-liquid-section,
            .newsletter-section,
            .footer-section {
                padding: 40px 20px;
            }
            
            .export-options {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="logo">
                <i class="fas fa-cubes"></i>
                <span>Advanced Page Builder</span>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary" id="templatesBtn">
                    <i class="fas fa-th-large"></i> Templates
                </button>
                <button class="btn btn-outline" id="previewBtn">
                    <i class="fas fa-eye"></i> Preview
                </button>
                <button class="btn btn-success" id="exportBtn">
                    <i class="fas fa-download"></i> Export
                </button>
                <button class="btn btn-primary" id="saveBtn">
                    <i class="fas fa-save"></i> Save
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Sidebar -->
            <div class="sidebar">
                <div class="sidebar-section">
                    <h3><i class="fas fa-th-large"></i> Advanced Templates</h3>
                    <div class="templates-grid" id="templatesGrid">
                        <!-- Templates will be loaded via JavaScript -->
                    </div>
                </div>

                <div class="sidebar-section">
                    <h3><i class="fas fa-puzzle-piece"></i> Page Sections</h3>
                    <div class="elements-grid" id="elementsGrid">
                        <div class="element-item" draggable="true" data-type="hero">
                            <i class="fas fa-star"></i>
                            <span>Hero Section</span>
                        </div>
                        <div class="element-item" draggable="true" data-type="image-text">
                            <i class="fas fa-image"></i>
                            <span>Image & Text</span>
                        </div>
                        <div class="element-item" draggable="true" data-type="collection">
                            <i class="fas fa-layer-group"></i>
                            <span>Collection Grid</span>
                        </div>
                        <div class="element-item" draggable="true" data-type="features">
                            <i class="fas fa-th-list"></i>
                            <span>Features</span>
                        </div>
                        <div class="element-item" draggable="true" data-type="testimonials">
                            <i class="fas fa-quote-left"></i>
                            <span>Testimonials</span>
                        </div>
                        <div class="element-item" draggable="true" data-type="custom-liquid">
                            <i class="fas fa-code"></i>
                            <span>Custom Code</span>
                        </div>
                        <div class="element-item" draggable="true" data-type="newsletter">
                            <i class="fas fa-envelope"></i>
                            <span>Newsletter</span>
                        </div>
                        <div class="element-item" draggable="true" data-type="footer">
                            <i class="fas fa-footer"></i>
                            <span>Footer</span>
                        </div>
                    </div>
                </div>

                <div class="sidebar-section">
                    <h3><i class="fas fa-image"></i> Media Library</h3>
                    <div class="media-upload-area" id="mediaUploadArea">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Drag & drop images or click to upload</p>
                        <input type="file" id="mediaUploadInput" accept="image/*" multiple style="display: none;">
                        <button class="btn btn-primary" id="uploadMediaBtn" style="padding: 8px 16px; font-size: 0.9rem;">
                            <i class="fas fa-upload"></i> Upload Images
                        </button>
                    </div>
                    <div class="uploaded-media" id="uploadedMedia">
                        <!-- Uploaded images will appear here -->
                    </div>
                </div>

                <div class="sidebar-section">
                    <h3><i class="fas fa-icons"></i> Icons</h3>
                    <div class="icon-categories" id="iconCategories">
                        <!-- Icon categories will be added dynamically -->
                    </div>
                    <div class="icon-grid" id="iconGrid">
                        <!-- Icons will be added dynamically -->
                    </div>
                </div>
            </div>

            <!-- Builder Area -->
            <div class="builder-area">
                <div class="drop-zone" id="dropZone">
                    <div class="drop-placeholder" id="dropPlaceholder">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <h3>Start Building Your Homepage</h3>
                        <p>Choose a template or drag sections from the sidebar to create a complete, long-form homepage.</p>
                        <button class="btn btn-primary" id="chooseTemplateBtn" style="margin-top: 20px; padding: 12px 30px;">
                            <i class="fas fa-th-large"></i> Browse Templates
                        </button>
                    </div>
                    <!-- Elements will be added here dynamically -->
                </div>
            </div>
        </div>
    </div>

    <!-- Templates Modal -->
    <div class="modal" id="templatesModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Advanced Templates</h2>
                <button class="close-modal" id="closeTemplates">&times;</button>
            </div>
            <div style="padding: 20px 0;">
                <div class="templates-grid" style="grid-template-columns: repeat(3, 1fr);">
                    <!-- Templates will be loaded here -->
                </div>
                <div style="margin-top: 30px; text-align: center;">
                    <button class="btn btn-primary" id="applyTemplateBtn" style="padding: 12px 30px;">
                        <i class="fas fa-check"></i> Apply Selected Template
                    </button>
                    <p style="margin-top: 15px; color: var(--gray); font-size: 0.9rem;">
                        Templates include multiple sections for creating comprehensive homepages
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Preview Modal -->
    <div class="modal" id="previewModal">
        <div class="modal-content" style="max-width: 1200px; padding: 0;">
            <div class="modal-header" style="position: sticky; top: 0; background: white; z-index: 10;">
                <h2>Full Page Preview</h2>
                <button class="close-modal" id="closePreview">&times;</button>
            </div>
            <div id="previewContent" style="max-height: 70vh; overflow-y: auto; padding: 20px;">
                <!-- Preview content will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div class="modal" id="exportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Export Your Page</h2>
                <button class="close-modal" id="closeExport">&times;</button>
            </div>
            <div class="export-options">
                <div class="export-option" id="exportHTML">
                    <i class="fab fa-html5"></i>
                    <h3>Export as HTML</h3>
                    <p>Download a complete HTML file with all your content</p>
                </div>
                <div class="export-option" id="exportCode">
                    <i class="fas fa-code"></i>
                    <h3>View Code</h3>
                    <p>Get the HTML code to copy and paste into your project</p>
                </div>
            </div>
            <div class="code-output" id="codeOutput">
                <div class="code-header">
                    <span>Generated HTML Code:</span>
                    <button class="copy-code-btn" id="copyCodeBtn">
                        <i class="fas fa-copy"></i> Copy Code
                    </button>
                </div>
                <pre id="codeContent"></pre>
            </div>
        </div>
    </div>

    <!-- Image Upload Modal -->
    <div class="modal" id="imageUploadModal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>Upload & Insert Image</h2>
                <button class="close-modal" id="closeImageUpload">&times;</button>
            </div>
            <div style="padding: 20px;">
                <div class="image-upload-area" id="imageDropArea">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <h3>Drag & Drop Image Here</h3>
                    <p>or click to browse files (Max: 5MB)</p>
                    <input type="file" id="imageFileInput" accept="image/*" style="display: none;">
                    <button class="btn btn-primary" style="margin-top: 15px;" id="browseImageBtn">
                        <i class="fas fa-folder-open"></i> Browse Files
                    </button>
                </div>
                <div id="imagePreviewContainer" style="margin-top: 20px; display: none;">
                    <h4 style="margin-bottom: 10px;">Preview:</h4>
                    <div style="height: 200px; background-size: cover; background-position: center; border-radius: var(--radius); margin-bottom: 15px;" id="imagePreview"></div>
                </div>
                <div style="display: flex; justify-content: flex-end; gap: 15px; margin-top: 25px;">
                    <button class="btn btn-outline" id="cancelImageUpload" style="color: var(--dark); border-color: var(--light-gray);">
                        Cancel
                    </button>
                    <button class="btn btn-primary" id="insertImageBtn" disabled>
                        <i class="fas fa-plus"></i> Insert Image
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span>Operation completed successfully!</span>
    </div>

    <script>
        // ==================== GLOBAL STATE ====================
        let elements = [];
        let selectedElement = null;
        let elementCounter = 0;
        let uploadedImages = [];
        let selectedTemplate = null;
        let currentImageUpload = null;
        let selectedIcon = null;
        let selectedImageTarget = null;

        // ==================== ADVANCED TEMPLATE DATA ====================
        const templates = [
            {
                id: 'corporate-pro',
                name: 'Corporate Pro',
                description: 'Complete corporate website with all sections',
                preview: 'https://images.unsplash.com/photo-1497366754035-f200968a6e72?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
                elements: [
                    {
                        type: 'hero',
                        content: {
                            title: 'Transform Your Business with Innovative Solutions',
                            subtitle: 'We help enterprises accelerate growth through cutting-edge technology and strategic consulting.',
                            buttonText: 'Schedule Consultation',
                            buttonLink: '#contact'
                        }
                    },
                    {
                        type: 'image-text',
                        content: {
                            title: 'Our Approach to Digital Transformation',
                            text: 'We combine industry expertise with advanced technology to deliver measurable results. Our team works closely with you to understand your challenges and implement solutions that drive real business value.',
                            imagePosition: 'left',
                            imageUrl: ''
                        }
                    },
                    {
                        type: 'features',
                        content: {
                            title: 'Core Services',
                            subtitle: 'Comprehensive solutions for modern businesses',
                            features: [
                                { title: 'Digital Strategy', icon: 'fas fa-chess-board', text: 'Data-driven strategic planning for digital success' },
                                { title: 'Cloud Migration', icon: 'fas fa-cloud-upload-alt', text: 'Seamless transition to cloud infrastructure' },
                                { title: 'AI Integration', icon: 'fas fa-robot', text: 'Intelligent automation and machine learning solutions' },
                                { title: 'Security Solutions', icon: 'fas fa-shield-alt', text: 'Enterprise-grade security and compliance' }
                            ]
                        }
                    },
                    {
                        type: 'collection',
                        content: {
                            title: 'Success Stories',
                            subtitle: 'See how we helped these companies achieve their goals',
                            items: [
                                { title: 'TechCorp Global', category: 'Digital Transformation', description: 'Increased operational efficiency by 45%', imageUrl: '' },
                                { title: 'FinSecure Bank', category: 'Security Implementation', description: 'Achieved 100% regulatory compliance', imageUrl: '' },
                                { title: 'RetailChain Pro', category: 'E-commerce Platform', description: 'Boosted online sales by 320%', imageUrl: '' }
                            ]
                        }
                    },
                    {
                        type: 'testimonials',
                        content: {
                            title: 'Client Testimonials',
                            testimonials: [
                                { name: 'Sarah Johnson', role: 'CEO, TechCorp', text: 'Their strategic guidance transformed our approach to digital. The results exceeded our expectations.' },
                                { name: 'Michael Chen', role: 'CTO, Global Solutions', text: 'Exceptional technical expertise and outstanding support throughout our cloud migration.' }
                            ]
                        }
                    },
                    {
                        type: 'custom-liquid',
                        content: {
                            title: 'Interactive Dashboard',
                            code: '<!-- Add your custom HTML/JavaScript dashboard code here -->\n<div class="dashboard-placeholder">\n  <h3>Custom Interactive Element</h3>\n  <p>Embed analytics, maps, calculators, or any custom component</p>\n</div>'
                        }
                    },
                    {
                        type: 'newsletter',
                        content: {
                            title: 'Stay Updated with Industry Insights',
                            subtitle: 'Subscribe to our newsletter for the latest trends and strategies'
                        }
                    },
                    {
                        type: 'footer',
                        content: {
                            columns: [
                                { title: 'Company', links: ['About', 'Careers', 'Press', 'Blog'] },
                                { title: 'Services', links: ['Consulting', 'Development', 'Security', 'Support'] },
                                { title: 'Resources', links: ['Whitepapers', 'Case Studies', 'Webinars', 'Tools'] },
                                { title: 'Contact', links: ['Support', 'Sales', 'Partnerships', 'Locations'] }
                            ],
                            copyright: 'Â© 2024 Corporate Pro. All rights reserved.'
                        }
                    }
                ]
            },
            {
                id: 'creative-portfolio',
                name: 'Creative Portfolio',
                description: 'Showcase creative work with visual layouts',
                preview: 'https://images.unsplash.com/photo-1517077304055-6e89abbf09b0?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
                elements: [
                    {
                        type: 'hero',
                        content: {
                            title: 'Creative Studio & Digital Agency',
                            subtitle: 'We craft immersive digital experiences that captivate audiences and drive engagement.',
                            buttonText: 'View Our Work',
                            buttonLink: '#portfolio'
                        }
                    },
                    {
                        type: 'image-text',
                        content: {
                            title: 'Our Creative Process',
                            text: 'Every project begins with deep understanding and ends with exceptional execution. We blend creativity with technology to deliver memorable experiences.',
                            imagePosition: 'right',
                            imageUrl: ''
                        }
                    },
                    {
                        type: 'collection',
                        content: {
                            title: 'Featured Projects',
                            subtitle: 'A curated selection of our recent creative work',
                            items: [
                                { title: 'Brand Identity', category: 'Design', description: 'Complete brand system for luxury fashion label', imageUrl: '' },
                                { title: 'Mobile App UI', category: 'UI/UX', description: 'Award-winning interface for fintech startup', imageUrl: '' },
                                { title: 'E-commerce Platform', category: 'Development', description: 'Scalable online store with custom features', imageUrl: '' },
                                { title: 'Marketing Campaign', category: 'Strategy', description: 'Integrated digital campaign with 300% ROI', imageUrl: '' },
                                { title: 'Website Redesign', category: 'Web Design', description: 'Modern responsive design for tech company', imageUrl: '' },
                                { title: 'Animation Series', category: 'Motion Graphics', description: 'Animated explainer videos for SaaS product', imageUrl: '' }
                            ]
                        }
                    },
                    {
                        type: 'features',
                        content: {
                            title: 'Our Expertise',
                            subtitle: 'What sets us apart',
                            features: [
                                { title: 'Visual Design', icon: 'fas fa-palette', text: 'Stunning visuals that communicate your brand story' },
                                { title: 'User Experience', icon: 'fas fa-users', text: 'Intuitive interfaces that users love to engage with' },
                                { title: 'Development', icon: 'fas fa-code', text: 'Robust, scalable solutions built with modern tech' },
                                { title: 'Strategy', icon: 'fas fa-chart-line', text: 'Data-driven approaches that deliver results' }
                            ]
                        }
                    },
                    {
                        type: 'custom-liquid',
                        content: {
                            title: 'Interactive Showcase',
                            code: '<!-- Embed your interactive portfolio, 3D models, or video galleries here -->\n<div style="text-align: center; padding: 40px; background: #f8f9fa; border-radius: 12px;">\n  <i class="fas fa-play-circle" style="font-size: 60px; color: #4361ee; margin-bottom: 20px;"></i>\n  <h3 style="margin-bottom: 10px;">Interactive Element Area</h3>\n  <p>Add video players, 3D viewers, or custom interactive components</p>\n</div>'
                        }
                    },
                    {
                        type: 'testimonials',
                        content: {
                            title: 'Client Love',
                            testimonials: [
                                { name: 'Alex Morgan', role: 'Creative Director', text: 'Their attention to detail and creative vision transformed our brand identity.' },
                                { name: 'Jamie Rivera', role: 'Product Manager', text: 'Exceptional work that exceeded all our expectations. Truly partners in our success.' }
                            ]
                        }
                    },
                    {
                        type: 'newsletter',
                        content: {
                            title: 'Join Our Creative Community',
                            subtitle: 'Get inspired with our latest projects and design insights'
                        }
                    }
                ]
            },
            {
                id: 'ecommerce-premium',
                name: 'E-commerce Premium',
                description: 'Complete online store with product showcases',
                preview: 'https://images.unsplash.com/photo-1556742049-0cfed4f6a45d?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
                elements: [
                    {
                        type: 'hero',
                        content: {
                            title: 'Premium Products for Discerning Customers',
                            subtitle: 'Discover our curated collection of luxury goods and exclusive items.',
                            buttonText: 'Shop Collection',
                            buttonLink: '#products'
                        }
                    },
                    {
                        type: 'image-text',
                        content: {
                            title: 'Craftsmanship & Quality',
                            text: 'Every product in our collection is carefully selected for its exceptional quality, sustainable materials, and timeless design. We partner with artisans who share our commitment to excellence.',
                            imagePosition: 'left',
                            imageUrl: ''
                        }
                    },
                    {
                        type: 'collection',
                        content: {
                            title: 'Featured Collections',
                            subtitle: 'Explore our most popular categories',
                            items: [
                                { title: 'Luxury Watches', category: 'Timepieces', description: 'Handcrafted precision watches', imageUrl: '' },
                                { title: 'Designer Bags', category: 'Accessories', description: 'Premium leather goods', imageUrl: '' },
                                { title: 'Fine Jewelry', category: 'Jewelry', description: 'Artisanal gold and diamond pieces', imageUrl: '' },
                                { title: 'Home Decor', category: 'Lifestyle', description: 'Elegant home accessories', imageUrl: '' },
                                { title: 'Men\'s Grooming', category: 'Personal Care', description: 'Premium grooming essentials', imageUrl: '' },
                                { title: 'Tech Accessories', category: 'Electronics', description: 'Luxury tech products', imageUrl: '' }
                            ]
                        }
                    },
                    {
                        type: 'features',
                        content: {
                            title: 'Why Shop With Us',
                            subtitle: 'Benefits of choosing our store',
                            features: [
                                { title: 'Free Worldwide Shipping', icon: 'fas fa-shipping-fast', text: 'Free delivery on all orders over $100' },
                                { title: 'Authenticity Guaranteed', icon: 'fas fa-certificate', text: '100% authentic products with certification' },
                                { title: 'Secure Payment', icon: 'fas fa-lock', text: 'Bank-level security for all transactions' },
                                { title: '24/7 Support', icon: 'fas fa-headset', text: 'Round-the-clock customer service' },
                                { title: 'Easy Returns', icon: 'fas fa-exchange-alt', text: '30-day return policy on all items' },
                                { title: 'Gift Services', icon: 'fas fa-gift', text: 'Premium gift wrapping and personalization' }
                            ]
                        }
                    },
                    {
                        type: 'testimonials',
                        content: {
                            title: 'Customer Reviews',
                            testimonials: [
                                { name: 'Emma Wilson', role: 'Verified Buyer', text: 'Exceptional quality and service. My go-to for luxury purchases.' },
                                { name: 'David Park', role: 'Collector', text: 'The attention to detail is remarkable. Truly premium experience.' }
                            ]
                        }
                    },
                    {
                        type: 'custom-liquid',
                        content: {
                            title: 'Live Product Showcase',
                            code: '<!-- Add product carousels, 360Â° viewers, or AR try-on features -->\n<div style="text-align: center; padding: 40px; background: linear-gradient(135deg, #4361ee, #3a56d4); color: white; border-radius: 12px;">\n  <i class="fas fa-vr-cardboard" style="font-size: 60px; margin-bottom: 20px;"></i>\n  <h3 style="margin-bottom: 10px;">Interactive Product Experience</h3>\n  <p>Embed AR viewers, product configurators, or live inventory displays</p>\n</div>'
                        }
                    },
                    {
                        type: 'newsletter',
                        content: {
                            title: 'Join Our Exclusive List',
                            subtitle: 'Be the first to access new collections and special offers'
                        }
                    },
                    {
                        type: 'footer',
                        content: {
                            columns: [
                                { title: 'Shop', links: ['All Products', 'New Arrivals', 'Best Sellers', 'Collections'] },
                                { title: 'Services', links: ['Personal Shopping', 'Gift Cards', 'Wedding Registry', 'Corporate Gifts'] },
                                { title: 'Information', links: ['About Us', 'Shipping Info', 'Returns', 'Size Guide'] },
                                { title: 'Support', links: ['Contact Us', 'FAQ', 'Privacy Policy', 'Terms of Service'] }
                            ],
                            copyright: 'Â© 2024 Luxury Emporium. All rights reserved.'
                        }
                    }
                ]
            }
        ];

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            loadSavedData();
        });

        function initializeApp() {
            loadTemplates();
            initIcons();
            updateDropZone();
        }

        // ==================== TEMPLATE SYSTEM ====================
        function loadTemplates() {
            const templatesGrid = document.getElementById('templatesGrid');
            const modalGrid = document.querySelector('#templatesModal .templates-grid');
            
            templatesGrid.innerHTML = '';
            modalGrid.innerHTML = '';
            
            templates.forEach(template => {
                const templateItem = createTemplateItem(template);
                templatesGrid.appendChild(templateItem);
                
                const modalItem = templateItem.cloneNode(true);
                modalItem.addEventListener('click', () => selectTemplate(template.id, true));
                modalGrid.appendChild(modalItem);
            });
            
            // Select first template by default
            if (templates.length > 0) {
                selectTemplate(templates[0].id);
            }
        }

        function createTemplateItem(template) {
            const div = document.createElement('div');
            div.className = 'template-item';
            div.dataset.id = template.id;
            div.innerHTML = `
                <div class="template-preview" style="background-image: url('${template.preview}')"></div>
                <div class="template-info">
                    <h4>${template.name}</h4>
                    <p>${template.description}</p>
                </div>
            `;
            div.addEventListener('click', () => selectTemplate(template.id));
            return div;
        }

        function selectTemplate(templateId, fromModal = false) {
            selectedTemplate = templates.find(t => t.id === templateId);
            
            document.querySelectorAll('.template-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const selector = fromModal ? 
                `#templatesModal .template-item[data-id="${templateId}"]` :
                `.template-item[data-id="${templateId}"]`;
            
            document.querySelector(selector)?.classList.add('active');
            
            if (fromModal) {
                showNotification(`Selected: ${selectedTemplate.name}`);
            }
        }

        // ==================== ELEMENT SYSTEM ====================
        function addElement(type, customContent = null) {
            elementCounter++;
            const elementId = `element-${elementCounter}`;
            
            const defaultContent = {
                'hero': {
                    title: 'Welcome to Our Website',
                    subtitle: 'This is a hero section. Add your main message here.',
                    buttonText: 'Get Started',
                    buttonLink: '#'
                },
                'image-text': {
                    title: 'Image & Text Section',
                    text: 'This section combines compelling imagery with engaging text. Perfect for telling your story or explaining your services.',
                    imagePosition: 'left',
                    imageUrl: ''
                },
                'collection': {
                    title: 'Featured Collection',
                    subtitle: 'Showcase your products, services, or portfolio items',
                    items: [
                        { title: 'Item One', category: 'Category', description: 'Description of item one', imageUrl: '' },
                        { title: 'Item Two', category: 'Category', description: 'Description of item two', imageUrl: '' },
                        { title: 'Item Three', category: 'Category', description: 'Description of item three', imageUrl: '' }
                    ]
                },
                'features': {
                    title: 'Our Features',
                    subtitle: 'What makes us special',
                    features: [
                        { title: 'Feature One', icon: 'fas fa-rocket', text: 'Description of feature one' },
                        { title: 'Feature Two', icon: 'fas fa-lightbulb', text: 'Description of feature two' },
                        { title: 'Feature Three', icon: 'fas fa-chart-line', text: 'Description of feature three' },
                        { title: 'Feature Four', icon: 'fas fa-shield-alt', text: 'Description of feature four' }
                    ]
                },
                'testimonials': {
                    title: 'What Our Clients Say',
                    testimonials: [
                        { name: 'John Doe', role: 'Client', text: 'Excellent service and outstanding results!' },
                        { name: 'Jane Smith', role: 'Customer', text: 'Highly recommend their professional approach.' }
                    ]
                },
                'custom-liquid': {
                    title: 'Custom Code Section',
                    code: '<!-- Paste your custom HTML, CSS, JavaScript, or embed code here -->\n<div style="padding: 40px; text-align: center; background: #f8f9fa; border-radius: 8px;">\n  <h3>Custom Content Area</h3>\n  <p>Embed videos, maps, forms, calculators, or any custom component</p>\n</div>'
                },
                'newsletter': {
                    title: 'Subscribe to Our Newsletter',
                    subtitle: 'Stay updated with our latest news and offers'
                },
                'footer': {
                    columns: [
                        { title: 'Quick Links', links: ['Home', 'About', 'Services', 'Contact'] },
                        { title: 'Resources', links: ['Blog', 'FAQ', 'Support', 'Documentation'] },
                        { title: 'Legal', links: ['Privacy Policy', 'Terms of Service', 'Cookies'] },
                        { title: 'Connect', links: ['Facebook', 'Twitter', 'Instagram', 'LinkedIn'] }
                    ],
                    copyright: `Â© ${new Date().getFullYear()} Your Company. All rights reserved.`
                }
            };

            const element = {
                id: elementId,
                type: type,
                content: customContent ? JSON.parse(JSON.stringify(customContent)) : JSON.parse(JSON.stringify(defaultContent[type])),
                order: elements.length
            };
            
            elements.push(element);
            renderElement(element);
            updateDropZone();
            saveToLocalStorage();
            
            const elementNames = {
                'hero': 'Hero Section',
                'image-text': 'Image & Text Section',
                'collection': 'Collection Grid',
                'features': 'Features Section',
                'testimonials': 'Testimonials',
                'custom-liquid': 'Custom Code Section',
                'newsletter': 'Newsletter Section',
                'footer': 'Footer Section'
            };
            
            showNotification(`${elementNames[type]} added successfully`);
        }

        function renderElement(element) {
            const elementDiv = document.createElement('div');
            elementDiv.className = 'page-element';
            elementDiv.id = element.id;
            elementDiv.draggable = true;
            
            // Drag events for reordering
            elementDiv.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', element.id);
                elementDiv.classList.add('dragging');
            });
            
            elementDiv.addEventListener('dragend', () => {
                elementDiv.classList.remove('dragging');
            });
            
            elementDiv.addEventListener('dragover', (e) => {
                e.preventDefault();
                if (!elementDiv.classList.contains('dragging')) {
                    elementDiv.classList.add('drag-over');
                }
            });
            
            elementDiv.addEventListener('dragleave', () => {
                elementDiv.classList.remove('drag-over');
            });
            
            elementDiv.addEventListener('drop', (e) => {
                e.preventDefault();
                elementDiv.classList.remove('drag-over');
                
                const draggedId = e.dataTransfer.getData('text/plain');
                if (draggedId !== element.id) {
                    reorderElements(draggedId, element.id);
                }
            });
            
            elementDiv.addEventListener('click', (e) => {
                if (!e.target.closest('.element-controls') && !e.target.closest('.image-placeholder')) {
                    selectElement(element.id);
                }
            });
            
            elementDiv.innerHTML = createElementHTML(element);
            dropZone.appendChild(elementDiv);
            
            // Add click event for image placeholders
            setTimeout(() => {
                const imagePlaceholders = elementDiv.querySelectorAll('.image-placeholder');
                imagePlaceholders.forEach(placeholder => {
                    placeholder.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const elementId = element.id;
                        const targetType = placeholder.dataset.target;
                        selectedImageTarget = { elementId, targetType };
                        openImageUploadModal();
                    });
                });
            }, 100);
        }

        function createElementHTML(element) {
            const controls = `
                <div class="element-controls">
                    <button class="edit-btn" title="Edit" onclick="editElement('${element.id}')">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="delete-btn" title="Delete" onclick="deleteElement('${element.id}')">
                        <i class="fas fa-trash"></i>
                    </button>
                    <button class="move-btn" title="Move" style="cursor: move;">
                        <i class="fas fa-arrows-alt"></i>
                    </button>
                </div>
            `;
            
            let content = '';
            
            switch(element.type) {
                case 'hero':
                    content = `
                        <div class="hero-section">
                            <h1 contenteditable="true" onblur="updateElementContent('${element.id}', 'title', this.textContent)">${element.content.title}</h1>
                            <p contenteditable="true" onblur="updateElementContent('${element.id}', 'subtitle', this.textContent)">${element.content.subtitle}</p>
                            <button class="btn btn-primary" style="background: white; color: var(--primary); border: none; font-size: 1.1rem; padding: 15px 30px;">
                                ${element.content.buttonText}
                            </button>
                        </div>
                    `;
                    break;
                    
                case 'image-text':
                    const imageContent = element.content.imageUrl ? 
                        `<img src="${element.content.imageUrl}" alt="Section Image" style="width: 100%; height: 100%; object-fit: cover;">` :
                        `<div class="image-placeholder" data-target="image-text">
                            <i class="fas fa-image"></i>
                            <p>Click to add image</p>
                        </div>`;
                    
                    content = `
                        <div class="image-text-section ${element.content.imagePosition === 'left' ? 'image-left' : 'image-right'}">
                            <div class="section-image">
                                ${imageContent}
                            </div>
                            <div class="section-content">
                                <h2 contenteditable="true" onblur="updateElementContent('${element.id}', 'title', this.textContent)">${element.content.title}</h2>
                                <p contenteditable="true" onblur="updateElementContent('${element.id}', 'text', this.textContent)">${element.content.text}</p>
                                <button class="btn btn-primary" style="padding: 12px 25px;">
                                    Learn More
                                </button>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'collection':
                    const collectionItems = element.content.items.map((item, index) => `
                        <div class="collection-item">
                            <div class="collection-image">
                                ${item.imageUrl ? 
                                    `<img src="${item.imageUrl}" alt="${item.title}">` :
                                    `<div class="image-placeholder" data-target="collection-${index}">
                                        <i class="fas fa-image"></i>
                                        <p>Add image</p>
                                    </div>`
                                }
                            </div>
                            <div class="collection-info">
                                <h3 contenteditable="true" onblur="updateCollectionItem('${element.id}', ${index}, 'title', this.textContent)">${item.title}</h3>
                                <div style="color: var(--primary); font-size: 0.9rem; font-weight: 600; margin-bottom: 10px;" 
                                     contenteditable="true" onblur="updateCollectionItem('${element.id}', ${index}, 'category', this.textContent)">
                                    ${item.category}
                                </div>
                                <p contenteditable="true" onblur="updateCollectionItem('${element.id}', ${index}, 'description', this.textContent)">${item.description}</p>
                                <button class="btn btn-outline" style="padding: 8px 20px; border-color: var(--primary); color: var(--primary);">
                                    View Details
                                </button>
                            </div>
                        </div>
                    `).join('');
                    
                    content = `
                        <div class="collection-section">
                            <h2 contenteditable="true" onblur="updateElementContent('${element.id}', 'title', this.textContent)">${element.content.title}</h2>
                            <p class="subtitle" contenteditable="true" onblur="updateElementContent('${element.id}', 'subtitle', this.textContent)">${element.content.subtitle}</p>
                            <div class="collection-grid">
                                ${collectionItems}
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'features':
                    const features = element.content.features.map((feature, index) => `
                        <div class="feature-card">
                            <i class="${feature.icon}" onclick="changeFeatureIcon('${element.id}', ${index})" style="cursor: pointer;"></i>
                            <h3 contenteditable="true" onblur="updateFeatureContent('${element.id}', ${index}, 'title', this.textContent)">${feature.title}</h3>
                            <p contenteditable="true" onblur="updateFeatureContent('${element.id}', ${index}, 'text', this.textContent)">${feature.text}</p>
                        </div>
                    `).join('');
                    
                    content = `
                        <div class="features-section">
                            <h2 contenteditable="true" onblur="updateElementContent('${element.id}', 'title', this.textContent)">${element.content.title}</h2>
                            <p class="subtitle" contenteditable="true" onblur="updateElementContent('${element.id}', 'subtitle', this.textContent)">${element.content.subtitle}</p>
                            <div class="features-grid">
                                ${features}
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'testimonials':
                    const testimonials = element.content.testimonials.map((testimonial, index) => `
                        <div class="testimonial-card">
                            <div class="testimonial-text" contenteditable="true" onblur="updateTestimonialContent('${element.id}', ${index}, 'text', this.textContent)">
                                ${testimonial.text}
                            </div>
                            <div class="testimonial-author">
                                <div class="author-avatar">
                                    ${testimonial.name.charAt(0)}
                                </div>
                                <div class="author-info">
                                    <h4 contenteditable="true" onblur="updateTestimonialContent('${element.id}', ${index}, 'name', this.textContent)">${testimonial.name}</h4>
                                    <p contenteditable="true" onblur="updateTestimonialContent('${element.id}', ${index}, 'role', this.textContent)">${testimonial.role}</p>
                                </div>
                            </div>
                        </div>
                    `).join('');
                    
                    content = `
                        <div class="testimonials-section">
                            <h2 contenteditable="true" onblur="updateElementContent('${element.id}', 'title', this.textContent)">${element.content.title}</h2>
                            <div class="testimonials-grid">
                                ${testimonials}
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'custom-liquid':
                    content = `
                        <div class="custom-liquid-section">
                            <h2 contenteditable="true" onblur="updateElementContent('${element.id}', 'title', this.textContent)">${element.content.title}</h2>
                            <div class="code-editor" contenteditable="true" onblur="updateElementContent('${element.id}', 'code', this.innerHTML)">
                                ${element.content.code}
                            </div>
                            <div class="code-preview">
                                <i class="fas fa-code" style="font-size: 40px; margin-bottom: 15px;"></i>
                                <p>Code preview will render here</p>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'newsletter':
                    content = `
                        <div class="newsletter-section">
                            <h2 contenteditable="true" onblur="updateElementContent('${element.id}', 'title', this.textContent)">${element.content.title}</h2>
                            <p contenteditable="true" onblur="updateElementContent('${element.id}', 'subtitle', this.textContent)">${element.content.subtitle}</p>
                            <form class="newsletter-form">
                                <input type="email" placeholder="Enter your email address">
                                <button type="submit" class="btn btn-primary" style="border-radius: 50px; padding: 15px 30px;">
                                    Subscribe
                                </button>
                            </form>
                        </div>
                    `;
                    break;
                    
                case 'footer':
                    const columns = element.content.columns.map((column, colIndex) => `
                        <div class="footer-column">
                            <h3 contenteditable="true" onblur="updateFooterColumn('${element.id}', ${colIndex}, 'title', this.textContent)">${column.title}</h3>
                            <ul class="footer-links">
                                ${column.links.map((link, linkIndex) => `
                                    <li>
                                        <a href="#" contenteditable="true" onblur="updateFooterLink('${element.id}', ${colIndex}, ${linkIndex}, this.textContent)">${link}</a>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                    `).join('');
                    
                    content = `
                        <div class="footer-section">
                            <div class="footer-grid">
                                ${columns}
                            </div>
                            <div class="footer-bottom">
                                <p contenteditable="true" onblur="updateElementContent('${element.id}', 'copyright', this.textContent)">${element.content.copyright}</p>
                            </div>
                        </div>
                    `;
                    break;
            }
            
            return controls + content;
        }

        // ==================== ELEMENT MANAGEMENT ====================
        function updateDropZone() {
            const pageElements = dropZone.querySelectorAll('.page-element');
            pageElements.forEach(el => el.remove());
            
            if (elements.length === 0) {
                dropPlaceholder.style.display = 'flex';
                return;
            }
            
            dropPlaceholder.style.display = 'none';
            elements.sort((a, b) => a.order - b.order).forEach(element => renderElement(element));
        }

        function selectElement(elementId) {
            if (selectedElement) {
                const prevElement = document.getElementById(selectedElement);
                if (prevElement) prevElement.classList.remove('selected');
            }
            
            selectedElement = elementId;
            const element = document.getElementById(elementId);
            if (element) {
                element.classList.add('selected');
            }
        }

        function deleteElement(elementId) {
            if (!confirm('Delete this section?')) return;
            
            const index = elements.findIndex(el => el.id === elementId);
            if (index !== -1) {
                elements.splice(index, 1);
                elements.forEach((el, i) => el.order = i);
                
                const elementDiv = document.getElementById(elementId);
                if (elementDiv) elementDiv.remove();
                
                updateDropZone();
                saveToLocalStorage();
                showNotification('Section deleted');
            }
        }

        function editElement(elementId) {
            const element = elements.find(el => el.id === elementId);
            if (element) {
                selectElement(elementId);
                showNotification(`Editing ${element.type} section`);
            }
        }

        function reorderElements(draggedId, targetId) {
            const draggedIndex = elements.findIndex(el => el.id === draggedId);
            const targetIndex = elements.findIndex(el => el.id === targetId);
            
            if (draggedIndex === -1 || targetIndex === -1) return;
            
            const draggedElement = elements[draggedIndex];
            elements.splice(draggedIndex, 1);
            elements.splice(targetIndex, 0, draggedElement);
            
            elements.forEach((el, i) => el.order = i);
            updateDropZone();
            saveToLocalStorage();
        }

        // ==================== CONTENT UPDATE FUNCTIONS ====================
        window.updateElementContent = function(elementId, field, value) {
            const element = elements.find(el => el.id === elementId);
            if (element) {
                element.content[field] = value;
                saveToLocalStorage();
            }
        };

        window.updateCollectionItem = function(elementId, itemIndex, field, value) {
            const element = elements.find(el => el.id === elementId);
            if (element && element.content.items && element.content.items[itemIndex]) {
                element.content.items[itemIndex][field] = value;
                saveToLocalStorage();
            }
        };

        window.updateFeatureContent = function(elementId, featureIndex, field, value) {
            const element = elements.find(el => el.id === elementId);
            if (element && element.content.features && element.content.features[featureIndex]) {
                element.content.features[featureIndex][field] = value;
                saveToLocalStorage();
            }
        };

        window.updateTestimonialContent = function(elementId, testimonialIndex, field, value) {
            const element = elements.find(el => el.id === elementId);
            if (element && element.content.testimonials && element.content.testimonials[testimonialIndex]) {
                element.content.testimonials[testimonialIndex][field] = value;
                saveToLocalStorage();
            }
        };

        window.updateFooterColumn = function(elementId, colIndex, field, value) {
            const element = elements.find(el => el.id === elementId);
            if (element && element.content.columns && element.content.columns[colIndex]) {
                element.content.columns[colIndex][field] = value;
                saveToLocalStorage();
            }
        };

        window.updateFooterLink = function(elementId, colIndex, linkIndex, value) {
            const element = elements.find(el => el.id === elementId);
            if (element && element.content.columns && element.content.columns[colIndex] && element.content.columns[colIndex].links) {
                element.content.columns[colIndex].links[linkIndex] = value;
                saveToLocalStorage();
            }
        };

        window.changeFeatureIcon = function(elementId, featureIndex) {
            selectedIcon = { elementId, featureIndex };
            showNotification('Select an icon from the sidebar to change this feature icon');
        };

        // ==================== DRAG & DROP FOR ELEMENTS ====================
        function setupDragAndDrop() {
            document.querySelectorAll('.element-item').forEach(item => {
                item.addEventListener('dragstart', function(e) {
                    e.dataTransfer.setData('text/plain', this.getAttribute('data-type'));
                    e.dataTransfer.effectAllowed = 'copy';
                });
            });

            dropZone.addEventListener('dragover', function(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'copy';
                this.classList.add('active');
            });

            dropZone.addEventListener('dragleave', function(e) {
                if (!this.contains(e.relatedTarget)) {
                    this.classList.remove('active');
                }
            });

            dropZone.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('active');
                
                const elementType = e.dataTransfer.getData('text/plain');
                if (elementType) {
                    addElement(elementType);
                }
            });
        }

        // ==================== IMAGE UPLOAD SYSTEM ====================
        function openImageUploadModal() {
            document.getElementById('imageUploadModal').classList.add('active');
        }

        function closeImageUploadModal() {
            document.getElementById('imageUploadModal').classList.remove('active');
            currentImageUpload = null;
            selectedImageTarget = null;
            document.getElementById('imageFileInput').value = '';
            document.getElementById('imagePreviewContainer').style.display = 'none';
            document.getElementById('insertImageBtn').disabled = true;
        }

        function handleImageUpload() {
            const fileInput = document.getElementById('imageFileInput');
            const file = fileInput.files[0];
            
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                showNotification('Please select an image file', 'error');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) {
                showNotification('Image exceeds 5MB limit', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                currentImageUpload = e.target.result;
                
                document.getElementById('imagePreview').style.backgroundImage = `url('${currentImageUpload}')`;
                document.getElementById('imagePreviewContainer').style.display = 'block';
                document.getElementById('insertImageBtn').disabled = false;
            };
            reader.readAsDataURL(file);
        }

        function insertImage() {
            if (!currentImageUpload || !selectedImageTarget) return;
            
            const element = elements.find(el => el.id === selectedImageTarget.elementId);
            if (!element) return;
            
            if (element.type === 'image-text') {
                element.content.imageUrl = currentImageUpload;
                showNotification('Image added to section');
            } else if (element.type === 'collection' && selectedImageTarget.targetType.startsWith('collection-')) {
                const index = parseInt(selectedImageTarget.targetType.split('-')[1]);
                if (element.content.items[index]) {
                    element.content.items[index].imageUrl = currentImageUpload;
                    showNotification('Image added to collection item');
                }
            }
            
            // Update the element in the DOM
            const elementDiv = document.getElementById(element.id);
            if (elementDiv) {
                elementDiv.innerHTML = createElementHTML(element);
            }
            
            saveToLocalStorage();
            closeImageUploadModal();
        }

        // ==================== ICON SYSTEM ====================
        function initIcons() {
            const categories = [
                { id: 'all', name: 'All Icons', icons: ['fa-rocket', 'fa-lightbulb', 'fa-chart-line', 'fa-users', 'fa-cog', 'fa-star', 'fa-heart', 'fa-trophy', 'fa-award', 'fa-gem', 'fa-bolt', 'fa-magic'] },
                { id: 'business', name: 'Business', icons: ['fa-chart-line', 'fa-briefcase', 'fa-building', 'fa-handshake', 'fa-lightbulb', 'fa-trophy', 'fa-award', 'fa-gem'] },
                { id: 'design', name: 'Design', icons: ['fa-palette', 'fa-pencil-ruler', 'fa-paint-brush', 'fa-eye-dropper', 'fa-vector-square', 'fa-crop', 'fa-bezier-curve', 'fa-brush'] },
                { id: 'development', name: 'Development', icons: ['fa-code', 'fa-laptop-code', 'fa-server', 'fa-database', 'fa-mobile-alt', 'fa-globe', 'fa-cogs', 'fa-terminal'] }
            ];
            
            const iconCategories = document.getElementById('iconCategories');
            iconCategories.innerHTML = '';
            
            categories.forEach(category => {
                const button = document.createElement('button');
                button.className = 'icon-category-btn';
                button.textContent = category.name;
                button.dataset.category = category.id;
                button.addEventListener('click', () => filterIcons(category.id));
                
                if (category.id === 'all') {
                    button.classList.add('active');
                }
                
                iconCategories.appendChild(button);
            });
            
            filterIcons('all');
        }

        function filterIcons(categoryId) {
            document.querySelectorAll('.icon-category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-category="${categoryId}"]`).classList.add('active');

            const allIcons = [
                'fa-rocket', 'fa-lightbulb', 'fa-chart-line', 'fa-users', 'fa-cog', 'fa-star', 'fa-heart', 'fa-trophy',
                'fa-award', 'fa-gem', 'fa-bolt', 'fa-magic', 'fa-briefcase', 'fa-building', 'fa-handshake', 'fa-palette',
                'fa-pencil-ruler', 'fa-paint-brush', 'fa-code', 'fa-laptop-code', 'fa-server', 'fa-database', 'fa-mobile-alt',
                'fa-globe', 'fa-shield-alt', 'fa-cloud-upload-alt', 'fa-robot', 'fa-chess-board', 'fa-certificate', 'fa-lock',
                'fa-headset', 'fa-exchange-alt', 'fa-gift', 'fa-shipping-fast', 'fa-vr-cardboard', 'fa-play-circle'
            ];

            const iconGrid = document.getElementById('iconGrid');
            iconGrid.innerHTML = '';
            
            allIcons.forEach(iconClass => {
                const iconItem = document.createElement('div');
                iconItem.className = 'icon-item';
                iconItem.innerHTML = `
                    <i class="fas ${iconClass}"></i>
                    <span>${iconClass.replace('fa-', '').replace('-', ' ')}</span>
                `;
                iconItem.addEventListener('click', () => selectIcon(iconClass));
                iconGrid.appendChild(iconItem);
            });
        }

        function selectIcon(iconClass) {
            if (selectedIcon) {
                const element = elements.find(el => el.id === selectedIcon.elementId);
                if (element && element.content.features && element.content.features[selectedIcon.featureIndex]) {
                    element.content.features[selectedIcon.featureIndex].icon = `fas ${iconClass}`;
                    
                    const elementDiv = document.getElementById(selectedIcon.elementId);
                    if (elementDiv) {
                        const iconElement = elementDiv.querySelectorAll('.feature-card i')[selectedIcon.featureIndex];
                        if (iconElement) {
                            iconElement.className = `fas ${iconClass}`;
                        }
                    }
                    
                    saveToLocalStorage();
                    showNotification('Icon updated');
                    selectedIcon = null;
                }
            } else {
                showNotification('Icon selected. Click on a feature icon to replace it.', 'warning');
            }
        }

        // ==================== EXPORT & PREVIEW ====================
        function showPreview() {
            if (elements.length === 0) {
                showNotification('No content to preview. Add sections first.', 'warning');
                return;
            }
            
            previewContent.innerHTML = '';
            const sortedElements = [...elements].sort((a, b) => a.order - b.order);
            
            sortedElements.forEach(element => {
                const elementDiv = document.createElement('div');
                elementDiv.innerHTML = createElementHTML(element);
                
                const controls = elementDiv.querySelector('.element-controls');
                if (controls) controls.remove();
                
                elementDiv.querySelectorAll('[contenteditable]').forEach(el => {
                    el.removeAttribute('contenteditable');
                });
                
                elementDiv.querySelectorAll('*').forEach(el => {
                    Array.from(el.attributes).forEach(attr => {
                        if (attr.name.startsWith('on')) {
                            el.removeAttribute(attr.name);
                        }
                    });
                });
                
                previewContent.appendChild(elementDiv);
            });
            
            previewModal.classList.add('active');
        }

        function exportAsHTML() {
            if (elements.length === 0) {
                showNotification('No content to export', 'warning');
                return;
            }
            
            const html = generateCompleteHTML();
            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'advanced-homepage.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('HTML file downloaded');
            exportModal.classList.remove('active');
        }

        function showCode() {
            if (elements.length === 0) {
                showNotification('No content to show', 'warning');
                return;
            }
            
            const html = generateCompleteHTML();
            document.getElementById('codeContent').textContent = html;
            document.getElementById('codeOutput').classList.add('active');
        }

        function generateCompleteHTML() {
            const sortedElements = [...elements].sort((a, b) => a.order - b.order);
            
            let elementsHTML = '';
            sortedElements.forEach(element => {
                const elementDiv = document.createElement('div');
                elementDiv.innerHTML = createElementHTML(element);
                
                const controls = elementDiv.querySelector('.element-controls');
                if (controls) controls.remove();
                
                elementDiv.querySelectorAll('[contenteditable]').forEach(el => {
                    el.removeAttribute('contenteditable');
                });
                
                elementDiv.querySelectorAll('*').forEach(el => {
                    Array.from(el.attributes).forEach(attr => {
                        if (attr.name.startsWith('on')) {
                            el.removeAttribute(attr.name);
                        }
                    });
                });
                
                elementsHTML += elementDiv.innerHTML + '\n\n';
            });
            
            return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Homepage</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@400;500;600;700&family=Roboto:wght@300;400;500;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* All CSS styles from builder */
        ${document.querySelector('style').textContent}
        
        /* Additional export styles */
        body {
            font-family: 'Roboto', sans-serif;
            color: #212529;
            margin: 0;
            padding: 0;
        }
        
        .exported-page {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .page-element {
            margin-bottom: 0;
        }
    </style>
</head>
<body>
    <div class="exported-page">
        ${elementsHTML}
    </div>
</body>
</html>`;
        }

        // ==================== SAVE & LOAD ====================
        function saveToLocalStorage() {
            localStorage.setItem('advancedPageBuilder', JSON.stringify(elements));
        }

        function loadSavedData() {
            const savedData = localStorage.getItem('advancedPageBuilder');
            if (savedData) {
                elements = JSON.parse(savedData);
                elementCounter = elements.length;
                updateDropZone();
            }
        }

        // ==================== NOTIFICATION ====================
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.querySelector('span').textContent = message;
            notification.className = 'notification';
            notification.classList.add(type, 'active');
            
            const icon = notification.querySelector('i');
            icon.className = type === 'success' ? 'fas fa-check-circle' :
                            type === 'error' ? 'fas fa-exclamation-circle' :
                            'fas fa-exclamation-triangle';
            
            setTimeout(() => notification.classList.remove('active'), 3000);
        }

        // ==================== EVENT LISTENERS ====================
        function setupEventListeners() {
            // Header buttons
            document.getElementById('templatesBtn').addEventListener('click', () => {
                document.getElementById('templatesModal').classList.add('active');
            });
            
            document.getElementById('chooseTemplateBtn').addEventListener('click', () => {
                document.getElementById('templatesModal').classList.add('active');
            });
            
            document.getElementById('previewBtn').addEventListener('click', showPreview);
            document.getElementById('exportBtn').addEventListener('click', () => {
                document.getElementById('exportModal').classList.add('active');
            });
            document.getElementById('saveBtn').addEventListener('click', () => {
                saveToLocalStorage();
                showNotification('Page saved successfully');
            });
            
            // Template modal
            document.getElementById('applyTemplateBtn').addEventListener('click', () => {
                if (!selectedTemplate) {
                    showNotification('Please select a template first', 'warning');
                    return;
                }
                
                if (elements.length > 0 && !confirm('Applying template will replace current content. Continue?')) {
                    return;
                }
                
                elements = [];
                elementCounter = 0;
                
                selectedTemplate.elements.forEach(elementData => {
                    addElement(elementData.type, elementData.content);
                });
                
                document.getElementById('templatesModal').classList.remove('active');
                showNotification(`"${selectedTemplate.name}" template applied`);
            });
            
            document.getElementById('closeTemplates').addEventListener('click', () => {
                document.getElementById('templatesModal').classList.remove('active');
            });
            
            // Preview modal
            document.getElementById('closePreview').addEventListener('click', () => {
                document.getElementById('previewModal').classList.remove('active');
            });
            
            // Export modal
            document.getElementById('closeExport').addEventListener('click', () => {
                document.getElementById('exportModal').classList.remove('active');
                document.getElementById('codeOutput').classList.remove('active');
            });
            
            document.getElementById('exportHTML').addEventListener('click', exportAsHTML);
            document.getElementById('exportCode').addEventListener('click', showCode);
            document.getElementById('copyCodeBtn').addEventListener('click', () => {
                const code = document.getElementById('codeContent').textContent;
                navigator.clipboard.writeText(code)
                    .then(() => showNotification('Code copied to clipboard'))
                    .catch(() => showNotification('Failed to copy code', 'error'));
            });
            
            // Image upload modal
            document.getElementById('browseImageBtn').addEventListener('click', () => {
                document.getElementById('imageFileInput').click();
            });
            
            document.getElementById('imageFileInput').addEventListener('change', handleImageUpload);
            document.getElementById('insertImageBtn').addEventListener('click', insertImage);
            document.getElementById('cancelImageUpload').addEventListener('click', closeImageUploadModal);
            document.getElementById('closeImageUpload').addEventListener('click', closeImageUploadModal);
            
            // Media upload
            document.getElementById('uploadMediaBtn').addEventListener('click', () => {
                document.getElementById('mediaUploadInput').click();
            });
            
            document.getElementById('mediaUploadInput').addEventListener('change', (e) => {
                const files = Array.from(e.target.files);
                if (files.length > 0) {
                    files.forEach(file => {
                        if (file.size > 5 * 1024 * 1024) {
                            showNotification(`${file.name} exceeds 5MB limit`, 'error');
                            return;
                        }
                        
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const img = document.createElement('div');
                            img.className = 'uploaded-media-item';
                            img.style.backgroundImage = `url('${e.target.result}')`;
                            img.title = file.name;
                            img.draggable = true;
                            
                            img.addEventListener('dragstart', (ev) => {
                                ev.dataTransfer.setData('text/plain', JSON.stringify({
                                    type: 'image',
                                    url: e.target.result
                                }));
                            });
                            
                            document.getElementById('uploadedMedia').appendChild(img);
                        };
                        reader.readAsDataURL(file);
                    });
                    
                    showNotification(`${files.length} image(s) uploaded`);
                    e.target.value = '';
                }
            });
            
            // Close modals on outside click
            window.addEventListener('click', (e) => {
                if (e.target.id === 'templatesModal') document.getElementById('templatesModal').classList.remove('active');
                if (e.target.id === 'previewModal') document.getElementById('previewModal').classList.remove('active');
                if (e.target.id === 'exportModal') document.getElementById('exportModal').classList.remove('active');
                if (e.target.id === 'imageUploadModal') closeImageUploadModal();
            });
            
            // Setup drag and drop
            setupDragAndDrop();
        }
    </script>
</body>
</html>